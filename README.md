# Jedi Council API Documentation

## Overview

The Jedi Council API is a secure and efficient system designed to manage and retrieve information about various Jedi across the galaxy. This system ensures the confidentiality and integrity of the data, allowing only authorized individuals to access and modify the information.

## Architecture

The system is built on AWS, utilizing services such as Lambda, API Gateway, DynamoDB, KMS, and Secrets Manager. The Lambda function is written in Python and handles all the logic for data retrieval and modification. The API Gateway acts as the entry point for all requests, ensuring secure and controlled access to the data. DynamoDB serves as the database, storing all the information about the Jedi. KMS is used for encryption needs, and Secrets Manager securely stores the API key required to access the POST method of the API.

## Design Decisions and Strategies

### Choice of AWS Services

#### AWS Lambda

**Reason**: AWS Lambda was chosen to implement the business logic of the system. It is highly scalable, making it suitable for handling variable workloads. Additionally, it runs only when invoked, reducing costs and simplifying management.

#### AWS API Gateway

**Reason**: API Gateway is used to expose HTTP endpoints for interacting with AWS Lambda. This provides a straightforward and secure interface for accessing the system. It also integrates with other AWS services, such as Lambda, making deployment easier.

#### Amazon DynamoDB

**Reason**: DynamoDB was selected as the database for storing information about Jedi. Its scalability, performance, and high availability capabilities make it a solid choice for an application that could have a high volume of data and traffic.

#### AWS Key Management Service (KMS)

**Reason**: KMS is used to manage encryption keys for data stored in DynamoDB. This ensures that data is secure and compliant with security regulations.

#### AWS Secrets Manager

**Reason**: Secrets Manager is used to securely store API keys. This protects the keys and ensures that only authorized parties have access to the system's resources.

### Implementation Strategies

#### Security

Security is a top priority. KMS keys are used to encrypt data stored in DynamoDB, ensuring the confidentiality of Jedi information. Secrets Manager secures API keys.

#### Scalability

The architecture is highly scalable. Lambda and DynamoDB automatically scale to handle variable workloads. This ensures the system can handle an increase in the number of Jedi seamlessly.

#### Efficiency

The use of AWS Lambda means resources are only used when the function is invoked. This reduces costs by avoiding constant server execution.

#### Maintenance

AWS manages the underlying infrastructure. Infrastructure as code (Terraform) is used to configure and deploy AWS services. This makes administration and ongoing maintenance of the system straightforward.

## How to Use the API

### Prerequisites

- An AWS account with the necessary permissions to access Lambda, API Gateway, DynamoDB, KMS, and Secrets Manager.
- The API key for secure access, stored in AWS Secrets Manager.
- Clone/fork this repository

### Preparing the lambda source code

```sh
cd lambda_function/
```

```sh
zip ../lambda_function.zip lambda_function.py ; cd ../
```

### Terraform Commands

To set up the infrastructure for the Jedi Council API, you need to run the following Terraform commands:

1. **Initialize Terraform**: This command is used to initialize a working directory containing Terraform configuration files.

   ```sh
   terraform init
   ```

2. **Plan Terraform Deployment**: This command creates an execution plan, which lets you preview the changes that Terraform plans to make to your infrastructure.

   ```sh
   terraform plan
   ```

3. **Apply Terraform Configuration**: This command applies the changes required to reach the desired state of the configuration, or the pre-determined set of actions generated by a terraform plan execution plan.

   ```sh
   terraform apply
   ```

   When prompted, enter `yes` to proceed with the application of the plan and be aware for the outputs, this will give the API URI and the Secrets Manager name that contains the API Key.

4. **Destroy Terraform Managed Infrastructure**: (Optional) This command is used to destroy Terraform-managed infrastructure.

   ```sh
   terraform destroy
   ```

   When prompted, enter `yes` to proceed with the destruction of the Terraform-managed infrastructure.

#### GET /jedi

- Description: Retrieve information about a specific Jedi or all Jedi if no ID is provided.
- Query Parameters (Optional):
  - `jedi_id`: The unique identifier of the Jedi.
- Headers:
  - `Content-Type`: application/json
  - `x-api-key`: The API key for authentication.
- Response:
  - `200 OK`: Returns the information about the Jedi or a list of all Jedi.
  - `400 Bad Request`: Missing `jedi_id` in the query parameters (only if required).
  - `404 Not Found`: The specified Jedi ID was not found or no Jedi in the database.
  - `500 Internal Server Error`: An error occurred on the server.

#### POST /jedi

- Description: Add a new Jedi to the database.
- Headers:
  - `Content-Type`: application/json
  - `x-api-key`: The API key for authentication.
- Body:
  - JSON object containing the Jedi information. The object's key should be the unique Jedi ID, and the value should be another object with the Jedi's details. Example:
    ```json
    {
      "93571": {
        "name": "Ki-Adi-Mundi",
        "planet": "Cerean",
        "power_level": 81
      }
    }
    ```
- Response:
  - `201 Created`: Jedi added successfully.
  - `400 Bad Request`: Invalid JSON or missing required fields.
  - `403 Forbidden`: Missing or invalid API key.
  - `409 Conflict`: A Jedi with the specified ID already exists.
  - `500 Internal Server Error`: An error occurred on the server.

## Examples using CURL

```bash
curl -H "x-api-key: APIKEY" https://rjzs8oksk4.execute-api.us-east-1.amazonaws.com/env_name/jedi
```

```bash
curl -H "x-api-key: APIKEY" https://rjzs8oksk4.execute-api.us-east-1.amazonaws.com/env_name/jedi\?jedi_id\=the_id_number
```

```bash
curl -X POST \
  https://rjzs8oksk4.execute-api.us-east-1.amazonaws.com/env_name/jedi \
  -H 'Content-Type: application/json' \
  -H 'x-api-key: APIKEY' \
  -d '[
  {"id": "09876", "name": "Jedi 1 Full Name", "planet": "Planet Name 1", "power_level": 90},
  {"id": "54321", "name": "Jedi 2 Full Name", "planet": "Planet Name 2", "power_level": 85},
  {"id": "12345", "name": "Jedi 3 Full Name", "planet": "Planet Name 3", "power_level": 80},
]'

```

```bash
curl -X POST \
  https://rjzs8oksk4.execute-api.us-east-1.amazonaws.com/env_name/jedi \
  -H 'Content-Type: application/json' \
  -H 'x-api-key: APIKEY' \
  -d '[{"id": "56789", "name": "Jedi Full Name", "planet": "Planet Name", "power_level": 70}]'
```

## Security

The API is secured using API keys. Use this API requires a valid API key to be included in the `x-api-key` header of the request. This API key is stored securely in AWS Secrets Manager, and its access is restricted to authorized individuals.

## Conclusion

The Jedi Council API provides a robust and secure solution for managing information about Jedi across the galaxy. By utilizing AWS services, we ensure the security, scalability, and reliability of the system, safeguarding the data and ensuring it is only accessible to authorized individuals. The detailed documentation and structured API ensure ease of use, allowing the Jedi Council to focus on their crucial mission without worrying about data management issues.